<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<title>rescached Documentation</title>
<meta name="author"	content="M.Shulhan"/>
<meta name="copyright"	content="kilabit.org"/>
<meta name="keywords"	content="rescached,resolver,dns,cache"/>
<style type="text/css">
body {
  width           : 800px;
  margin          : 10px auto 10px auto;
  padding	  : 8px;
  border	  : solid black 1px;
}
h2 {
  color		  : white;
  background-color: black;
  border-bottom	  : solid silver;
  margin	  : 3em 0px 0px 0px;
  padding	  : 16px 4px 4px 8px;
}
h3 {
  background-color: silver;
  border-bottom	  : solid grey;
  margin	  : 2em 0px 0px 0px;
  padding	  : 16px 4px 4px 8px;
}
pre {
  font-family	  : monospace;
  color		  : white;
  background-color: #032900;
  padding	  : 4px 4px 4px 16px;
  border-bottom	  : solid black;
}
table {
  margin	  : 8px 0px 8px 0px;
  border-collapse : collapse;
}
th {
  background-color: silver;
  text-align	  : left;
  vertical-align  : text-top;
  padding	  : 4px;
  border	  : 1px solid grey;
}
td {
  padding	  : 4px;
  border	  : 1px solid grey;
}
a {
  text-decoration : none;
}
blockquote {
  left		  : 50%;
  text-align	  : right;
  font-style	  : oblique;
  margin-bottom	  : 2em;
}
.toc {
  border-top	  : 2px solid black;
  border-bottom	  : 2px solid black;
  padding	  : 8px;
}
</style>
</head>
<body>

<h1>rescached Documentation</h1>
<a href="http://www.kilabit.org" target="_blank"> .:: kilabit.org ::. </a>
<br />
<br />
August 2010
<br />
<br />
<br />

<div class="toc">
<ul>
<li><a href="#intro"> Introduction </a></li>
  <li style="list-style: none">
  <ul>
  <li><a href="#intro_what_is_rescached"> What Is rescached ?</a></li>
  <li><a href="#intro_feature_and_limit"> Features and Limitations </a></li>
  <li><a href="#intro_behind_the_dns"> Behind The DNS </a></li>
  <li><a href="#intro_how_cache_in_rescached_work"> How Cache In rescached Work </a></li>
  </ul>
  </li>
<li><a href="#installation"> Installation </a></li>
  <li style="list-style: none">
  <ul>
  <li><a href="#install_prerequisite"> Prerequisite </a></li>
  <li><a href="#install_compile"> Compiling From Source </a></li>
  <li><a href="#install"> Installation </a></li>
  <li><a href="#install_post"> Post Installation Configuration </a></li>
  </ul>
  </li>
<li><a href="#config"> Configuration </a></li>
  <li style="list-style: none">
  <ul>
  <li><a href="#config_service"> Controlling rescached service </a></li>
  <li><a href="#config_startup"> rescached Startup Option </a></li>
  </ul>
  </li>
<li><a href="#dev_notes"> Developer Notes </a></li>
</ul>
</div>

<h2><a name="intro"> Introduction </a></h2>

<h3><a name="intro_what_is_rescached"> What Is rescached ?</a></h3>

<p>
<tt>rescached</tt> is domain name service cache, it caching internet name and
address on local memory when running and in local disk when not running.
</p>

<h3>
<a name="intro_feature_and_limit">
Features and Limitations.
</a>
</h3>

<p>
<tt>rescached</tt> is not a reimplementation of DNS server like BIND.
<tt>rescached</tt>
primary goal is only to caching DNS queries and answers, used by personal
or small group of users, to minimize unneeded traffic to outside network.
</p>

Features,

<ul>
  <li> Enable to handle UDP and TCP connections. </li>
  <li> Saving/loading cache to/from disk </li>
</ul>

Limitations,

<ul>
  <li> Only know specific DNS record type,</li>
  <li style="list-style: none">
    <ul>
    <li> A : a host address </li>
    <li> NS : an authoritative name server </li>
    <li> CNAME : a canonical name for an alias </li>
    <li> MX : mail exchange </li>
    </ul>
  </li>
  <li> Only run and tested in Unix system </li>
</ul>

<h3><a name="intro_behind_the_dns"> Behind The DNS </a></h3>

<blockquote>
A short story on how DNS work in your system.
</blockquote>

<p>
When you opened some website, let say <i>www.reddit.com</i>, in a browser, the
first thing that browser do is to translate name address <i>www.reddit.com</i>
into an internet address (i.e.: 219.83.126.10) so browser can make a connection to
<i>www.reddit.com</i> server.
</p>
<p>
How browser do that ? First, it will send query to one of DNS server listed in
your system configuration (<tt>/etc/resolv.conf</tt> in Unix). Then, if your
DNS server also "caching" the name that you requested, it will reply the
answer (internet address) directly, if it is not then it will ask to their
parent DNS server.
</p>

<pre>
+----+      +----------------+      +------------------+
| PC | &lt;==&gt; | ISP DNS Server | &lt;==&gt; | Other DNS Server | &lt;==&gt; ...
+----+      +----------------+      +------------------+
</pre>

<p>
If you browsing frequently on the same site, hitting the refresh button,
opening a page on the same website, etc.; this procedures will always
repeated every times.
</p>
<p>
To make this repetitive procedures less occurred, you can run
<tt>rescached</tt> in your personal computer. The first time answer is
received in your local computer, <tt>rescached</tt> will saved it in computer
memory and any later request of the same address will be answered directly by
<tt>rescached</tt>
</p>

<pre>
+----+      +----------------+      +------------------+
| PC |      | ISP DNS Server | &lt;==&gt; | Other DNS Server | &lt;==&gt; ...
+----+      +----------------+      +------------------+
  ^^             ^^
  ||             ||
  vv             ||
+-----------+    ||
| rescached | &lt;==//
+-----------+
</pre>

<p>
The only request that send to your DNS server is the one that does not already
exist in <tt>rescached</tt>.
</p>


<h3><a name="intro_how_cache_in_rescached_work">
How Cache In rescached Work
</a></h3>

<blockquote>
rescached in technical side of view.
</blockquote>

<p>
Each of query and answer data in cache have a number of accessed field, which
defined how the cache will be ordered in memory. The frequently queried
host-name will be at the top of cache list, and less queried host-name will at
the bottom of cache list. This, obviously, will make a cache list based on
user habit (frequently accessed host-name), which effect on the search time
on cache list: fast reply.
</p>

<pre>
+-----+-----------------+
| #   | host-name       |
+-----+-----------------+
| 529 | www.reddit.com  |
+-----+-----------------+
| 233 | www.google.com  |
+-----+-----------------+
| ... |       ...       |
+-----+-----------------+
| 1   | www.kilabit.org |
+-----+-----------------+
</pre>

<p>
The number of cache that <tt>rescached</tt> can hold in memory is depend on
the value of <a href="#cache.max"><tt>cache.max</tt></a> in configuration
file.

When the number of cache in memory reached it <tt>cache.max</tt> value, it
will remove all cache data that has the number of frequently accessed less
than <a href="#cache.threshold"><tt>cache.threshold</tt></a>.
</p>


<h2>
<a name="installation">
Installation
</a>
</h2>


<h3>
<a name="install_prerequisite">
Prerequisite
</a>
</h3>

<ul>
<li> c++ compiler </li>
<li> make tools </li>
<li> git SCM </li>
<li> system V init tool for service. </li>
</ul>

<h3>
<a name="install_compile">
Compiling From Source
</a>
</h3>

<pre>
$ git clone http://www.github.com/shuLhan/rescached.git rescached.git
$ git clone http://www.github.com/shuLhan/libvos.git libvos.git
$ cd rescached.git/src
$ ln -s ../../libvos.git lib
$ make
</pre>

<h3><a name="install"> Installation </h3>

<p>
After program successfully build, you can install it manually or using make
program.
</p>
<h4> Install using make program </h4>
<p>
Installing using make in linux system using <tt>init.d</tt> (I.e. OpenSuSE) use,
<pre>
$ sudo make install
</pre>
</p>

<p>
For Arch linux, which use <tt>rc.d</tt>, use,
<pre>
$ sudo make install-arch
</pre>
</p>


<h4> Manual Installation </h4>
<ul>
<li> Copy rescached configuration to system directory. <br/>
<p>
Assume that we use directory "<tt>/etc/rescached</tt>" as configuration
directory, then
<pre>
$ sudo mkdir /etc/rescached
$ sudo cp rescached.cfg /etc/rescached
</pre>
</p>
</li>

<li> Create directory for cache file. <br/>
<p>
In example we use "<tt>/var/cache/rescached</tt>" as cache directory,
</p>
<pre>
$ sudo mkdir /var/cache/rescached
</pre>
<p>
If you use different cache directory, do not forget to change the
configuration option.
</p>
</li>

<li> Copy rescached program to your system path. <br/>
<pre>
$ sudo cp build/rescached /usr/sbin
</pre>
</li>

<li> Create system startup script. </br>
<p>
If you want your program running each time the system is up you can create a
system startup script. You can see an example for openSuSE startup script in
file <tt>scripts/rescached.run</tt>, or <tt>scripts/rescached.arch</tt> for
Arch Linux system.
</p>
<p>
This step is really different between each system, consult your distribution
forum or mailing-list for how to create system startup script.
</p>
</li>
</ul>

<h3>
<a name="install_post">
Post Installation Configuration
</a>
</h3>

<ul>
<li>Set your parent DNS server.</li>
    <li style="list-style-type: none; list-style-image: none; list-style-position: outside;">
    <p>
    Edit rescached configuration, <tt>/etc/rescached/rescached.cfg</tt>,
change the value of <a href="#server.parent"><tt>server.parent</tt></a> based
on your preferred DNS server.
    </p>
    </li>
<li> Set maximum caches. </li>
    <li style="list-style-type: none; list-style-image: none; list-style-position: outside;">
    <p>
    Edit rescached configuration, <tt>/etc/rescached/rescached.cfg</tt>,
change the value of <a href="#cache.max"><tt>cache.max</tt></a> and/or <a
href="#cache.threshold"><tt>cache.threshold</tt></a> to match your needs.
    </p>
    </li>
<li> Set your system DNS server to point to rescached </li>
    <li style="list-style-type: none; list-style-image: none; list-style-position: outside;">
    <p>
    In Unix,
    </p>
    <pre>
$ sudo mv /etc/resolv.conf /etc/resolv.conf.org
$ sudo echo "nameserver 127.0.0.1" &gt; /etc/resolv.conf
    </pre>
    </li>
</ul>


<h2>
<a name="config">
Configuration
</a>
</h2>


<h3>
<a name="config_service">
Controlling rescached Service
</a>
</h3>

<p>
After <tt>rescached</tt> has been installed you can start, stop, and view
status of <tt>rescached</tt> service using <tt>/sbin/rcrescached</tt>.
</p>

<ul>
  <li> Starting rescached service. </li>
  <li style="list-style-type: none;">
  <pre>
$ sudo /sbin/rcrescached start
</pre>
  <br/>
  </li>

  <li> Stopping rescached service. </li>
  <li style="list-style-type: none;">
  <pre>
$ sudo /sbin/rcrescached stop
</pre>
  <br/>
  </li>

  <li> View status of service. </li>
  <li style="list-style-type: none;">
  <pre>
$ sudo /sbin/rcrescached status
</pre>
  <br/>
        <b>NOTE:</b> status option is not available in Arch Linux system.
  </li>
</ul>

<h3>
<a name="config_startup">
rescached Startup Option
</a>
</h3>

<p>
All <tt> rescached </tt> startup option located in file
<tt>/etc/rescached/rescached.cfg</tt>. In this file you can see some comment for
any option and some possible value.  This section will explain more about
each option and how they effect <tt>rescached</tt>.
</p>

<ul>
<li><tt><a name="file.data"> file.data </a></tt></li>
 
<li style="list-style-type: none; list-style-image: none; list-style-position: outside;">
<table summary="rescached file.data option">
<tr><th> Value </th>
    <td> A path to a cache file. </td></tr>
<tr><th> Format </th>
    <td> /any/path/to/file </td></tr>
<tr><th> Default </th>
    <td> rescached.vos </td></tr>
<tr><th> Description </th>
    <td>
This file contain all DNS answers that rescached collected while
running. When rescached stopped it will saved all DNS answer in this
file, so when rescached is started again it will load all data in this file to
memory again.  If not set, then rescached will load/save the cache to the file
named <tt>rescached.vos</tt> in current directory where user running rescached.
</td></tr>
</table>
<br />
</li>

<li><tt><a name="file.data.backup"> file.data.backup </a></tt></li>

<li style="list-style-type: none; list-style-image: none; list-style-position: outside;">
<table summary="rescached file.data.backup option">
<tr><th> Value </th>
    <td> A name of of backup file, with or without path. </td>
    </tr>
<tr><th> Format </th>
    <td> /any/path/to/file </td>
    </tr>
<tr><th> Default </th>
    <td> file.data + ".bak" </td>
    </tr>
<tr><th> Description </th>
    <td>
This file is a backup of <tt>file.data</tt>, it will be created only if
rescached program exit successfully without error.

If not set then it will have the same name with the value in
<tt>file.data</tt> but with additional suffix, <i>.bak</i>. </td>
    </tr>
</table>
<br />
</li>


<li><tt><a name="file.pid"> file.pid </a></tt></li>

<li style="list-style-type: none; list-style-image: none; list-style-position: outside;">
<table summary="rescached file.pid option">
<tr><th> Value </th>
    <td> A path to process id file. </td>
    </tr>
<tr><th> Format </th>
    <td> /any/path/to/file </td>
    </tr>
<tr><th> Default </th>
    <td> rescached.pid </td>
    </tr>
<tr><th> Description </th>
    <td>
When <tt>rescached</tt> program started, it will create this file as a
mediator to any system service. Content of this file is process ID (PID) of
rescached program in system.  If not set then the default name will be used,
and it will be saved in current directory where user running rescached. </td>
    </tr>
</table>
<br />
</li>


<li><tt><a name="file.log"> file.log </a></tt></li>

<li style="list-style-type: none; list-style-image: none; list-style-position: outside;">
<table summary="rescached file.log option">
<tr><th> Value </th>
    <td> A name of rescached log file. </td>
    </tr>
<tr><th> Format </th>
    <td> /any/path/to/file </td>
    </tr>
<tr><th> Default </th>
    <td> rescached.log </td>
    </tr>
<tr><th> Description </th>
    <td>
This file contain log of program when running. Verbosity of log output is
depend on value of <a href="#debug"><tt>debug</tt></a> option.
    </td>
    </tr>
</table>
<br />
</li>


<li><tt><a name="server.parent"> server.parent </a></tt></li>

<li style="list-style-type: none; list-style-image: none; list-style-position: outside;">
<table summary="rescached server.parent option">
<tr><th> Value </th>
    <td> List of parent DNS servers, separated by commas. </td>
    </tr>
<tr><th> Format </th>
    <td> IP-ADDRESS:PORT, IP-ADDRESS:PORT, ... </td>
    </tr>
<tr><th> Default </th>
    <td><ul>
        <li> Address : 8.8.8.8, 8.8.4.4 </li>
        <li> Port    : 53 </li>
        </ul>
    </td>
    </tr>
<tr><th> Description </th>
    <td>
When <tt>rescached</tt> receive a query from client and when it does not have a cached
address of query, it will pass the query to those parent server.
<br />
<tt>rescached</tt> use a Google DNS public server as a default parent address
if not set. The reason for this is that Google DNS public server use a simple
and small size of response/answer. Please, do not use OpenDNS server, because
OpenDNS will reply with it own address, instead of replying with no answer, if
certain host-name not found (i.e. typo in host-name), this will make
<tt>rescached</tt> caching a false data.
<br />
To check if your parent server reply the unknown host-name with no answer, use
<tt>dig</tt> tool.
</td>
    </tr>
</table>
<br />
</li>


<li><tt><a name="server.listen"> server.listen </a></tt></li>

<li style="list-style-type: none; list-style-image: none; list-style-position: outside;">
<table summary="rescached server.listen option">
<tr><th> Value </th>
    <td> Local IP address that rescached will listening for client request. </td>
    </tr>
<tr><th> Format </th>
    <td> &lt;IP-ADDRESS&gt; </td>
    </tr>
<tr><th> Default </th>
    <td> 127.0.0.1 </td>
    </tr>
<tr><th> Description </th>
    <td>
Address in local network where <tt>rescached</tt> will listening for query
from client. If you want <tt>rescached</tt> to serve a query from another host
in your local network, change this value to <tt>0.0.0.0</tt>
    </td>
    </tr>
</table>
<br />
</li>


<li><tt><a name="server.listen.port"> server.listen.port </a></tt></li>

<li style="list-style-type: none; list-style-image: none; list-style-position: outside;">
<table summary="rescached server.listen.port option">
<tr><th> Value </th>
    <td> Port for listening for client request </td>
    </tr>
<tr><th> Format </th>
    <td> Any number between 1 to 65535 </td>
    </tr>
<tr><th> Default </th>
    <td> 53 </td>
    </tr>
<tr><th> Description </th>
    <td>
Beside the <tt>server.listen</tt> address, <tt>rescached</tt> also need to
known which port it will opening for receiving client queries. You should not
change this value, because technically every client (browser, email client,
etc.) will always send the query to port 53.
    </td>
    </tr>
</table>
<br />
</li>


<li><tt><a name="server.timeout"> server.timeout </a></tt></li>

<li style="list-style-type: none; list-style-image: none; list-style-position: outside;">
<table summary="rescached server.timeout option">
<tr><th> Value </th>
    <td> Timeout value, in second, before cleaning queue.</td>
    </tr>
<tr><th> Format </th>
    <td> Any number between 300 to 2147483647. </td>
    </tr>
<tr><th> Default </th>
    <td> 300 </td>
    </tr>
<tr><th> Description </th>
    <td>
This option set the server timeout value. If time out is reached, all the
old queries (that is older than <tt>server.timeout</tt>) in queue that does
not receipt a reply from parent server will be removed.
    </td>
    </tr>
</table>
<br />
</li>


<li><tt><a name="cache.max"> cache.max </a></tt></li>

<li style="list-style-type: none; list-style-image: none; list-style-position: outside;">
<table summary="rescached cache.max option">
<tr><th> Value </th>
    <td> Maximum number of host-name and address that will keep in memory. </td>
    </tr>
<tr><th> Format </th>
    <td> Any number between 1 and 2147483647. </td>
    </tr>
<tr><th> Default </th>
    <td> 100000 </td>
    </tr>
<tr><th> Description </th>
    <td>
When <tt>rescached</tt> running it will keep all queries and answers in memory
as much as <tt>cache.max</tt>.
The bigger the <tt>cache.max</tt> value, then the more <tt>rescached</tt>
will use memory.
    </td>
    </tr>
</table>
<br />
</li>


<li><tt><a name="cache.threshold"> cache.threshold </a></tt></li>

<li style="list-style-type: none; list-style-image: none; list-style-position: outside;">
<table summary="rescached cache.threshold option">
<tr><th> Value </th>
    <td> Minimum value for cache status. </td>
    </tr>
<tr><th> Format </th>
    <td> Any number between 1 and 2147483647. </td>
    </tr>
<tr><th> Default </th>
    <td> 1 </td>
    </tr>
<tr><th> Description </th>
    <td>
When <tt>rescached</tt> cache all the queries and answers, until long enough
it will reached it own maximum value (<tt>cache.max</tt>), when it happen
<tt>rescached</tt> will remove all cache that their number-of-queried value
is less than <tt>cache.threshold</tt>.
    </td>
    </tr>
</table>
<br />
</li>

<li><tt><a name="cache.mode"> cache.mode </a></tt></li>

<li style="list-style-type: none; list-style-image: none; list-style-position: outside;">
<table summary="rescached cache.mode option">
<tr><th> Value </th>
    <td> cache mode, affect how the cache will be saved in disk/memory. </td>
    </tr>
<tr><th> Format </th>
    <td> Number between 1 and 2. </td>
    </tr>
<tr><th> Default </th>
    <td> 2 </td>
    </tr>
<tr><th> Description </th>
    <td>
If <tt>cache.mode</tt> is set to 1, all DNS record will be keep forever, no
possible query or renewed DNS record happen until the specific DNS record
removed from cache.
<br/><br/>
If <tt>cache.mode</tt> is set to 2 (default), all DNS record will be keep
only after the specific time, based on maximum TTL value in DNS record. If
TTL is reached, hostname will be queried again to the DNS parent server, and
old cache and TTL value will be replaced with a new one.
</p>
    </td>
    </tr>
</table>
<br />
</li>

<li><tt><a name="debug"> debug </a></tt></li>

<li style="list-style-type: none; list-style-image: none; list-style-position: outside;">
<table summary="rescached debug option">
<tr><th> Value </th>
    <td><ul>
    <li> 0 : log nothing. </li>
    <li> 1 : log startup, request, response, and exit status. </li>
    <li> 2 : log startup, request, response, caches, and exit status. </li>
    </ul></td>
    </tr>
<tr><th> Format </th>
    <td> Any number between 0 and 2. </td>
    </tr>
<tr><th> Default </th>
    <td> 0 </td>
    </tr>
<tr><th> Description </th>
    <td>
This option only used by developer for debugging program.
    </td>
    </tr>
</table>
<br />
</li>


<!-- rescached option template
<li><tt> </tt></li>
<table summary="rescached option">
<tr><th> Value </th>
    <td> </td>
    </tr>
<tr><th> Format </th>
    <td> </td>
    </tr>
<tr><th> Default </th>
    <td> </td>
    </tr>
<tr><th> Description </th>
    <td> </td>
    </tr>
</table>
-->
</ul>

</body>
</html>
